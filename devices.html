<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Device Info & Edit</title>
</head>
<body>
  <h2>Device Info</h2>
  <div id="info">Loading...</div>

  <h3>Edit Device</h3>
  <form id="editForm" style="display:none;">
    <label>ID: <input type="text" id="id" readonly></label><br>
    <label>Model: <input type="text" id="model"></label><br>
    <label>Issue: <input type="text" id="issue"></label><br>
    <label>Status: <input type="text" id="status"></label><br>
    <label>Last Updated: <input type="date" id="lastUpdated"></label><br>
    <button type="submit">Generate Updated JSON</button>
  </form>

  <h3>Updated JSON</h3>
  <pre id="output"></pre>

  <script>
    async function loadDevice() {
      const urlParams = new URLSearchParams(window.location.search);
      const deviceId = urlParams.get('id');
      const res = await fetch('./devices.json');
      const devices = await res.json();
      const device = devices.find(d => d.id === deviceId);

      const infoDiv = document.getElementById('info');
      const form = document.getElementById('editForm');

      if (device) {
        infoDiv.innerHTML = `
          <p><strong>ID:</strong> ${device.id}</p>
          <p><strong>Model:</strong> ${device.model}</p>
          <p><strong>Issue:</strong> ${device.issue}</p>
          <p><strong>Status:</strong> ${device.status}</p>
          <p><strong>Last Updated:</strong> ${device.lastUpdated}</p>
        `;

        // پر کردن فرم با اطلاعات فعلی
        document.getElementById('id').value = device.id;
        document.getElementById('model').value = device.model;
        document.getElementById('issue').value = device.issue;
        document.getElementById('status').value = device.status;
        document.getElementById('lastUpdated').value = device.lastUpdated;

        form.style.display = 'block';
      } else {
        infoDiv.innerHTML = `<p>Device not found.</p>`;
      }
    }

    document.getElementById('editForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const updatedDevice = {
        id: document.getElementById('id').value,
        model: document.getElementById('model').value,
        issue: document.getElementById('issue').value,
        status: document.getElementById('status').value,
        lastUpdated: document.getElementById('lastUpdated').value
      };
      document.getElementById('output').textContent = JSON.stringify(updatedDevice, null, 2);
    });

    loadDevice();
  </script>
</body>
</html>