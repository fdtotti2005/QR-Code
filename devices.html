<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>تست تاریخ شمسی</title>
  <script src="https://cdn.jsdelivr.net/npm/jalaali-js@1.1.0/index.min.js"></script>
</head>
<body>
  <h2>اطلاعات دستگاه</h2>
  <div id="info">در حال بارگذاری...</div>

  <h3>ویرایش اطلاعات</h3>
  <form id="editForm" style="display:none;">
    <label>شناسه</label>
    <input type="text" id="id" readonly>

    <label>مدل</label>
    <input type="text" id="model">

    <label>مشکل</label>
    <input type="text" id="issue">

    <label>وضعیت</label>
    <input type="text" id="status">

    <label>آخرین بروزرسانی</label>
    <input type="date" id="lastUpdated">

    <button type="submit">ذخیره</button>
  </form>

  <h3>خروجی JSON</h3>
  <pre id="output"></pre>

  <script>
    const devices = [
      {
        id: "device001",
        model: "X100",
        issue: "Battery low",
        status: "Pending",
        lastUpdated: "2025-09-07"
      },
      {
        id: "device002",
        model: "Z200",
        issue: "Screen cracked",
        status: "In repair",
        lastUpdated: "2025-09-06"
      }
    ];

    function toJalali(gDate) {
      const [y, m, d] = gDate.split('-').map(Number);
      const j = toJalaali(y, m, d);
      return `${j.jy}/${String(j.jm).padStart(2, '0')}/${String(j.jd).padStart(2, '0')}`;
    }

    const urlParams = new URLSearchParams(window.location.search);
    const deviceId = urlParams.get('id');
    const device = devices.find(d => d.id === deviceId);
    const infoDiv = document.getElementById('info');
    const form = document.getElementById('editForm');

    if (device) {
      const jalaliDate = toJalali(device.lastUpdated);
      infoDiv.innerHTML = `
        <p>شناسه: ${device.id}</p>
        <p>مدل: ${device.model}</p>
        <p>مشکل: ${device.issue}</p>
        <p>وضعیت: ${device.status}</p>
        <p>آخرین بروزرسانی (شمسی): ${jalaliDate}</p>
      `;

      document.getElementById('id').value = device.id;
      document.getElementById('model').value = device.model;
      document.getElementById('issue').value = device.issue;
      document.getElementById('status').value = device.status;
      document.getElementById('lastUpdated').value = device.lastUpdated;

      form.style.display = 'block';
    } else {
      infoDiv.innerHTML = `<p style="color:red;">❌ دستگاه با شناسه "${deviceId}" پیدا نشد.</p>`;
    }

    document.getElementById('editForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const updatedDevice = {
        id: document.getElementById('id').value,
        model: document.getElementById('model').value,
        issue: document.getElementById('issue').value,
        status: document.getElementById('status').value,
        lastUpdated: document.getElementById('lastUpdated').value
      };
      document.getElementById('output').textContent = JSON.stringify(updatedDevice, null, 2);
    });
  </script>
</body>
</html>
